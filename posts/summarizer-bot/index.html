<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions | Tommaso Colella | SWE</title>
<meta name=keywords content><meta name=description content="A friend asked me to create a Telegram channel to cross-post my articles onto (I did! You can find it here). The idea seemed nice, but I didn&rsquo;t want to bother with writing a small summary for each article every time, and most of all, forgetful as I am, I would absolutely forget to post to the channel.
I only had one choice: automate everything using GitHub Actions, Azure Function Apps, and Azure OpenAI, trying to have fun and learn something new in the process."><meta name=author content="Tommaso Colella"><link rel=canonical href=https://gioleppe.github.io/posts/summarizer-bot/><meta name=google-site-verification content="G-JHDYWZPGQF"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://gioleppe.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gioleppe.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gioleppe.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://gioleppe.github.io/apple-touch-icon.png><link rel=mask-icon href=https://gioleppe.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gioleppe.github.io/posts/summarizer-bot/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/ld+json>{"@context":"https://schema.org/","@type":"Person","name":"Tommaso Colella","url":"https://gioleppe.github.io/","image":"https://media.licdn.com/dms/image/C5603AQEo-0VsShX7eg/profile-displayphoto-shrink_400_400/0/1612869300096?e=1676505600&v=beta&t=C0ZDSUriW6h0wK3Py6DoZ8viruvCLJdTg99jQCGsl9Y","sameAs":["https://www.linkedin.com/in/tommaso-colella-051012143/","https://github.com/gioleppe","https://www.facebook.com/amuchina"],"jobTitle":"Software Engineer","worksFor":{"@type":"Organization","name":"YOOX Net-a-Porter Group S.p.A"}}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-JHDYWZPGQF"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-JHDYWZPGQF",{anonymize_ip:!1})}</script><meta property="og:title" content="How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions"><meta property="og:description" content="A friend asked me to create a Telegram channel to cross-post my articles onto (I did! You can find it here). The idea seemed nice, but I didn&rsquo;t want to bother with writing a small summary for each article every time, and most of all, forgetful as I am, I would absolutely forget to post to the channel.
I only had one choice: automate everything using GitHub Actions, Azure Function Apps, and Azure OpenAI, trying to have fun and learn something new in the process."><meta property="og:type" content="article"><meta property="og:url" content="https://gioleppe.github.io/posts/summarizer-bot/"><meta property="og:image" content="https://gioleppe.github.io/images/summarizer-hero-cropped-small.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-27T16:48:19+00:00"><meta property="article:modified_time" content="2024-02-27T16:48:19+00:00"><meta property="og:site_name" content="Tommaso Colella"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://gioleppe.github.io/images/summarizer-hero-cropped-small.jpg"><meta name=twitter:title content="How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions"><meta name=twitter:description content="A friend asked me to create a Telegram channel to cross-post my articles onto (I did! You can find it here). The idea seemed nice, but I didn&rsquo;t want to bother with writing a small summary for each article every time, and most of all, forgetful as I am, I would absolutely forget to post to the channel.
I only had one choice: automate everything using GitHub Actions, Azure Function Apps, and Azure OpenAI, trying to have fun and learn something new in the process."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gioleppe.github.io/posts/"},{"@type":"ListItem","position":2,"name":"How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions","item":"https://gioleppe.github.io/posts/summarizer-bot/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions","name":"How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions","description":"A friend asked me to create a Telegram channel to cross-post my articles onto (I did! You can find it here). The idea seemed nice, but I didn\u0026rsquo;t want to bother with writing a small summary for each article every time, and most of all, forgetful as I am, I would absolutely forget to post to the channel.\nI only had one choice: automate everything using GitHub Actions, Azure Function Apps, and Azure OpenAI, trying to have fun and learn something new in the process.","keywords":[],"articleBody":"A friend asked me to create a Telegram channel to cross-post my articles onto (I did! You can find it here). The idea seemed nice, but I didn‚Äôt want to bother with writing a small summary for each article every time, and most of all, forgetful as I am, I would absolutely forget to post to the channel.\nI only had one choice: automate everything using GitHub Actions, Azure Function Apps, and Azure OpenAI, trying to have fun and learn something new in the process.\nLet‚Äôs jump straight into the design phase!\nArchitecture The architecture of my solution is quite simple here.\nThe ingredients are the following:\nA Github Action that triggers when I push a new article on my personal blog An LLM or similar model to summarise my article. We‚Äôll be using GPT-4 deployed over Azure OpenAI An Azure Function to quickly glue the deployed LLM and the Telegram API with GitHub Actions Here‚Äôs a graphical depiction of the REST calls involved:\nThe Github Action calls the Azure Function (1), which retrieves the article‚Äôs raw markdown from my GitHub repo (2). The text is passed to the LLM, which summarizes it (3), and the summary is finally sent to the Telegram API (4).\nI will start by refining the existing YAML workflow that builds my blog. After that, I‚Äôm going to code the integration function.\nGithub Action I prefer convention over configuration, so I set myself to only trigger the function app whenever I commit something with a commit message starting with ‚Äúarticle:‚Äù in a sort of Conventional-Commits-like style. I also provide the name of the folder holding the article so I can pass it to the Azure Function later.\nüí°Please note I used a bottom-up approach, starting from the GitHub Action, because I already had made up a plan. The integration only needs a small amount of data to transit (just the article‚Äôs folder name), so it was easier for me to reason this way.\nI quickly asked GPT-4 to create a Github Action for me, and it came up with some reasonable code, which I modified to obtain the following Job:\ntrigger-summarizer: runs-on: ubuntu-latest if: startsWith(github.event.head_commit.message, 'article:') needs: deploy steps: - name: Call Summarizer env: FUNCTION_URL: ${{ secrets.LOGIC_APP_URL }} run: | COMMIT_MESSAGE=\"${{ github.event.head_commit.message }}\" ARTICLE_NAME=$(echo $COMMIT_MESSAGE | awk '{print $2}') curl -X POST $FUNCTION_URL \\ -H \"Content-Type: application/json\" \\ --data \"{\\\"articleName\\\": \\\"$ARTICLE_NAME\\\"}\" As you can see, I check if the commit message starts with ‚Äúarticle:‚Äù and then I get the second word of the message using AWK. Finally, I make a POST call to the Azure Function using curl, passing the article folder‚Äôs name to it. We will add the FUNCTION_URL secret later after deploying our Azure Function, so don‚Äôt worry about that now.\nI added the Job to my Workflow, which builds my Hugo-based blog. Find the code here to check how the Job integrates with the preexisting Workflow logic.\nNow, let‚Äôs develop our Azure Function!\nAzure Function I‚Äôm jumping straight to the Azure Function, not showing anything related to the Azure OpenAI service. This is because I already have an article that explains how to deploy Azure OpenAI. Find it here if you are interested.\nüí° Be sure to correctly configure your GPT-4 deployment to avoid any problems with throttling!\nWe are using the V2 Python programming model for Azure Functions. It is way better than the V1 model in that it lets you define triggers and bindings in line, using Python decorators instead of a separate function.json file, and makes for a more ergonomic experience.\nCheck this quickstart and install Azure Functions Core Tools if you want to follow along.\nLet‚Äôs follow the suggestions of the tutorial:\nmkdir summarizer_bot_function cd .\\summarizer_bot_function\\ func init --model V2 --python func new --name SummarizerFunction --template \"HTTP trigger\" --authlevel \"function\" At this point, you should have a folder like this:\nWe still lack some libraries we need, so run the following command to install some missing libraries (requests and openai) and record the libraries in requirements.txt:\npip install requests openai pip freeze \u003e requirements.txt I‚Äôm avoiding it for brevity, but consider using a Python venv to avoid library problems with future projects.\nNow, we can launch Visual Studio Code with code . (provided we are still in the same terminal directory) and start developing our Function. Replace the code in function_app.py so that it resembles the following (code is autopep8-formatted):\nimport azure.functions as func import logging import os from openai import AzureOpenAI import requests azure_endpoint = os.getenv('AZURE_OPENAI_ENDPOINT') azure_key = os.getenv('AZURE_OPENAI_KEY') telegram_bot_token = os.getenv('TELEGRAM_BOT_TOKEN') telegram_channel_id = os.getenv('TELEGRAM_CHANNEL_ID') client = AzureOpenAI( azure_endpoint=azure_endpoint, api_key=azure_key, api_version=\"2023-05-15\" ) app = func.FunctionApp() @app.route(route=\"SummarizerFunction\", auth_level=func.AuthLevel.FUNCTION, methods=[\"POST\"]) def summarizer(req: func.HttpRequest) -\u003e func.HttpResponse: logging.info('Python HTTP trigger function processed a request.') # deserialize article name from request body req_body = req.get_json() article_name = req_body.get('articleName') # retrieve article raw markdown content from GitHub raw_md_content = requests.get( f\"https://github.com/gioleppe/gioleppe.github.io/blob/main/content/posts/{article_name}/index.md\").text response = client.chat.completions.create( model=\"gpt4_turbo\", # model = \"deployment_name\". messages=[ {\"role\": \"system\", \"content\": \"You are a skilled copywriter. You must summarize the following article in 50 words, the summary will be used as short intro to the linked article in a Telegram channel.\"}, {\"role\": \"user\", \"content\": raw_md_content} ] ) # initialize the raw string markdown content telegram_message_text = f\"{response.choices[0].message.content}\\n\\n[Read the Article](https://gioleppe.github.io/posts/{article_name}/)\" # post message on telegram channel in markdown format telegram_response = requests.post(f\"https://api.telegram.org/bot{telegram_bot_token}/sendMessage\", data={ \"chat_id\": telegram_channel_id, \"text\": telegram_message_text, \"parse_mode\": \"Markdown\"}) # req_body = req.get_json() return func.HttpResponse(f\"Telegram responded with: {telegram_response}\", status_code=telegram_response.status_code) To make this work, you will have to set the following environmental variables:\nAZURE_OPENAI_ENDPOINT: the endpoint of our Azure OpenAI Service AZURE_OPENAI_KEY: the key of our Azure OpenAI Service TELEGRAM_BOT_TOKEN: the token for the telegram bot that posts to our channel TELEGRAM_CHANNEL_ID: the ID of the channel we want to post to üí°To post on the Telegram channel, we need a bot that has enough permission to post on that specific channel. After creating the channel, check the walkthrough here to obtain a token. Finally, add your bot to the channel. To get the ID of your channel for usage in the code above, follow the steps outlined here.\nAssuming you‚Äôve set all the parameters above, we can test our Azure Function by running func start:\nAs you can see, the Azure Function is waiting for our input. You can either use curl like me or a graphical tool such as Insomnia to make the request:\nPS C:\\Users\\tommaso.colella\\projects\\articles\\summarizer_bot_function\u003e curl -X POST http://localhost:7071/api/SummarizerFunction -H 'Content-Type: application/json' -d '{\"articleName\" : \"diy-copilot-phi\"}' Telegram responded with: If we check our Telegram channel, we can see a freshly made post:\nIt worked perfectly! The summary is how I wanted it to be. Now, we have to deploy our Function App to Azure. Then, we can test our deployment by committing this new post on Git Hub!\nDeploying and testing the Function App First, provision a new serverless Function App on your Azure subscription. You can follow the instructions here to do it with the Azure CLI or use the Azure Portal.\nNote the name of your Function App. In my case, it is called summarizer-bot-fap. Now, we can use the Azure Functions Core Tools to deploy our Function App as follows:\nfunc azure functionapp publish üí°Remember to set the App Settings for the Function App on the portal or via the command line. If you need extra security, consider using Key Vault references.\nIf the publish step worked correctly, you should see the Function in the Functions tab of your Function App:\nNow press on the name of your Azure Function, and click the Get Function Url button. The URL you just copied contains the default Host key needed to authenticate to your Function App. It is a proper secret, so treat it carefully! We will use it to call our Function from GitHub Actions.\nNow head over to GitHub and Add the FUNCTION_URL in the repo settings. If you need help, follow the guide here. In the end, you should see this in your repo‚Äôs Secrets and Variables/Action Secrets section:\nAnd that‚Äôs it! Time to test the deployment by committing to the repo. We use ‚Äúarticle: diy-copilot-phi test function app‚Äù as a commit message.\nAfter a while, we can see that the trigger summarizer Job is green! If we check the channel, we can see our summary with the relative article link, but I‚Äôm sparing you the picture this time!\nConclusions We have seen how to create a simple summarization solution using Azure OpenAI, Azure Functions, and GitHub Actions. Our solution could be extended as someone might want to check the produced summary before publishing it: this could be achieved by further refining our Telegram integration and introducing a secondary private channel to approve, modify, or reject summaries. I might do that in a future article, but for my actual need, this implementation is enough.\nThank you for coming this far. Power to the nerds!\nReferences Conventional Commits\nAWK command in Unix/Linux with examples - GeeksforGeeks\nDeploying AzureOpenAI Service using OpenTofu | Tommaso Colella | SWE (gioleppe.github.io)\nCreate a Python function from the command line - Azure Functions | Microsoft Learn\nrequests ¬∑ PyPI\nopenai ¬∑ PyPI\nvenv ‚Äî Creation of virtual environments ‚Äî Python 3.11.8 documentation\nFrom BotFather to ‚ÄòHello World‚Äô (telegram.org)\nCreate a serverless function app using the Azure CLI | Microsoft Learn\nUse Key Vault references - Azure App Service | Microsoft Learn\nUsing secrets in GitHub Actions - GitHub Docs\n","wordCount":"1559","inLanguage":"en","image":"https://gioleppe.github.io/images/summarizer-hero-cropped-small.jpg","datePublished":"2024-02-27T16:48:19Z","dateModified":"2024-02-27T16:48:19Z","author":{"@type":"Person","name":"Tommaso Colella"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gioleppe.github.io/posts/summarizer-bot/"},"publisher":{"@type":"Organization","name":"Tommaso Colella | SWE","logo":{"@type":"ImageObject","url":"https://gioleppe.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gioleppe.github.io/ accesskey=h title="Tommaso Colella | SWE (Alt + H)">Tommaso Colella | SWE</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://gioleppe.github.io/about title="About Me"><span>About Me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gioleppe.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://gioleppe.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">How to build a Summarizer Bot using GPT4, Azure Functions, GitHub Actions</h1><div class=post-meta><span title='2024-02-27 16:48:19 +0000 UTC'>February 27, 2024</span>&nbsp;¬∑&nbsp;8 min&nbsp;¬∑&nbsp;Tommaso Colella</div></header><figure class=entry-cover><img loading=eager src=https://gioleppe.github.io/images/summarizer-hero-cropped-small.jpg alt="Railway in Lisbon"><p>Photo by <a href=https://unsplash.com/@chriskristiansen>Chris Blonk</a> on Unsplash</p></figure><div class=post-content><p>A friend asked me to create a Telegram channel to cross-post my articles onto (I did! You can find it <a href=https://t.me/tomstechcorner>here</a>). The idea seemed nice, but I didn&rsquo;t want to bother with writing a small summary for each article every time, and most of all, forgetful as I am, I would absolutely forget to post to the channel.</p><p>I only had one choice: automate everything using GitHub Actions, Azure Function Apps, and Azure OpenAI, trying to have fun and learn something new in the process.</p><p>Let&rsquo;s jump straight into the design phase!</p><hr><h3 id=architecture>Architecture<a hidden class=anchor aria-hidden=true href=#architecture>#</a></h3><p>The architecture of my solution is quite simple here.</p><p>The ingredients are the following:</p><ol><li>A Github Action that triggers when I push a new article on my personal blog</li><li>An LLM or similar model to summarise my article. We&rsquo;ll be using GPT-4 deployed over Azure OpenAI</li><li>An Azure Function to quickly glue the deployed LLM and the Telegram API with GitHub Actions</li></ol><p>Here&rsquo;s a graphical depiction of the REST calls involved:</p><p><img loading=lazy src=images/summarizer_interaction.png alt="Summarizer Interaction"></p><p>The Github Action calls the Azure Function <strong>(1)</strong>, which retrieves the article&rsquo;s raw markdown from my GitHub repo <strong>(2)</strong>. The text is passed to the LLM, which summarizes it <strong>(3)</strong>, and the summary is finally sent to the Telegram API <strong>(4)</strong>.</p><p>I will start by refining the existing YAML workflow that builds my blog. After that, I&rsquo;m going to code the integration function.</p><h3 id=github-action>Github Action<a hidden class=anchor aria-hidden=true href=#github-action>#</a></h3><p>I prefer convention over configuration, so I set myself to only trigger the function app whenever I commit something with a commit message starting with &ldquo;article:&rdquo; in a sort of <a href=https://www.conventionalcommits.org/en/v1.0.0/>Conventional-Commits-like</a> style. I also provide the name of the folder holding the article so I can pass it to the Azure Function later.</p><blockquote><p>üí°Please note I used a bottom-up approach, starting from the GitHub Action, because I already had made up a plan. The integration only needs a small amount of data to transit (just the article&rsquo;s folder name), so it was easier for me to reason this way.</p></blockquote><p>I quickly asked GPT-4 to create a Github Action for me, and it came up with some reasonable code, which I modified to obtain the following Job:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span><span class=nt>trigger-summarizer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>startsWith(github.event.head_commit.message, &#39;article:&#39;)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>needs</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Call Summarizer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>FUNCTION_URL</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.LOGIC_APP_URL }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          COMMIT_MESSAGE=&#34;${{ github.event.head_commit.message }}&#34;
</span></span></span><span class=line><span class=cl><span class=sd>          ARTICLE_NAME=$(echo $COMMIT_MESSAGE | awk &#39;{print $2}&#39;)
</span></span></span><span class=line><span class=cl><span class=sd>          curl -X POST  $FUNCTION_URL \
</span></span></span><span class=line><span class=cl><span class=sd>            -H &#34;Content-Type: application/json&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            --data &#34;{\&#34;articleName\&#34;: \&#34;$ARTICLE_NAME\&#34;}&#34;</span><span class=w>          
</span></span></span></code></pre></div><p>As you can see, I check if the commit message starts with &ldquo;article:&rdquo; and then I get the second word of the message using <a href=https://www.geeksforgeeks.org/awk-command-unixlinux-examples/>AWK</a>. Finally, I make a POST call to the Azure Function using curl, passing the article folder&rsquo;s name to it. We will add the <em>FUNCTION_URL</em> secret later after deploying our Azure Function, so don&rsquo;t worry about that now.</p><p>I added the Job to my Workflow, which builds my Hugo-based blog. Find the code <a href=https://github.com/gioleppe/gioleppe.github.io/blob/main/.github/workflows/gh-pages.yml>here</a> to check how the Job integrates with the preexisting Workflow logic.</p><p>Now, let&rsquo;s develop our Azure Function!</p><h3 id=azure-function>Azure Function<a hidden class=anchor aria-hidden=true href=#azure-function>#</a></h3><p>I&rsquo;m jumping straight to the Azure Function, not showing anything related to the Azure OpenAI service. This is because I already have an article that explains how to deploy Azure OpenAI. Find it <a href=https://gioleppe.github.io/posts/azure-openai-service-opentofu/>here</a> if you are interested.</p><blockquote><p>üí° Be sure to correctly configure your GPT-4 deployment to avoid any problems with throttling!</p></blockquote><p>We are using the V2 Python programming model for Azure Functions. It is way better than the V1 model in that it lets you define triggers and bindings in line, using Python decorators instead of a separate <em>function.json</em> file, and makes for a more ergonomic experience.</p><p>Check <a href="https://learn.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-python?pivots=python-mode-decorators&amp;tabs=windows%2Cbash%2Cazure-cli">this quickstart</a> and install Azure Functions Core Tools if you want to follow along.</p><p>Let&rsquo;s follow the suggestions of the tutorial:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir summarizer_bot_function
</span></span><span class=line><span class=cl><span class=nb>cd</span> .<span class=se>\s</span>ummarizer_bot_function<span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>func init --model V2 --python
</span></span><span class=line><span class=cl>func new --name SummarizerFunction --template <span class=s2>&#34;HTTP trigger&#34;</span> --authlevel <span class=s2>&#34;function&#34;</span>
</span></span></code></pre></div><p>At this point, you should have a folder like this:</p><p><img loading=lazy src=images/summarizer_fap_folder alt="Summarizer Function App folder"></p><p>We still lack some libraries we need, so run the following command to install some missing libraries (<a href=https://pypi.org/project/requests/>requests</a> and <a href=https://pypi.org/project/openai/>openai</a>) and record the libraries in requirements.txt:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install requests openai
</span></span><span class=line><span class=cl>pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>I&rsquo;m avoiding it for brevity, but consider using a <a href=https://docs.python.org/3.11/library/venv.html>Python venv </a>to avoid library problems with future projects.</p><p>Now, we can launch Visual Studio Code with <code>code .</code> (provided we are still in the same terminal directory) and start developing our Function. Replace the code in function_app.py so that it resembles the following (code is autopep8-formatted):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>azure.functions</span> <span class=k>as</span> <span class=nn>func</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>openai</span> <span class=kn>import</span> <span class=n>AzureOpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>azure_endpoint</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;AZURE_OPENAI_ENDPOINT&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>azure_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;AZURE_OPENAI_KEY&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>telegram_bot_token</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;TELEGRAM_BOT_TOKEN&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>telegram_channel_id</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;TELEGRAM_CHANNEL_ID&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>AzureOpenAI</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>azure_endpoint</span><span class=o>=</span><span class=n>azure_endpoint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>api_key</span><span class=o>=</span><span class=n>azure_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>api_version</span><span class=o>=</span><span class=s2>&#34;2023-05-15&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>func</span><span class=o>.</span><span class=n>FunctionApp</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=n>route</span><span class=o>=</span><span class=s2>&#34;SummarizerFunction&#34;</span><span class=p>,</span> <span class=n>auth_level</span><span class=o>=</span><span class=n>func</span><span class=o>.</span><span class=n>AuthLevel</span><span class=o>.</span><span class=n>FUNCTION</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;POST&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>summarizer</span><span class=p>(</span><span class=n>req</span><span class=p>:</span> <span class=n>func</span><span class=o>.</span><span class=n>HttpRequest</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>func</span><span class=o>.</span><span class=n>HttpResponse</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>logging</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s1>&#39;Python HTTP trigger function processed a request.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># deserialize article name from request body</span>
</span></span><span class=line><span class=cl>    <span class=n>req_body</span> <span class=o>=</span> <span class=n>req</span><span class=o>.</span><span class=n>get_json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>article_name</span> <span class=o>=</span> <span class=n>req_body</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;articleName&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># retrieve article raw markdown content from GitHub</span>
</span></span><span class=line><span class=cl>    <span class=n>raw_md_content</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;https://github.com/gioleppe/gioleppe.github.io/blob/main/content/posts/</span><span class=si>{</span><span class=n>article_name</span><span class=si>}</span><span class=s2>/index.md&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>chat</span><span class=o>.</span><span class=n>completions</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt4_turbo&#34;</span><span class=p>,</span>  <span class=c1># model = &#34;deployment_name&#34;.</span>
</span></span><span class=line><span class=cl>        <span class=n>messages</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;system&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=s2>&#34;You are a skilled copywriter. You must summarize the following article in 50 words, the summary will be used as short intro to the linked article in a Telegram channel.&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;user&#34;</span><span class=p>,</span> <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>raw_md_content</span><span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># initialize the raw string markdown content</span>
</span></span><span class=line><span class=cl>    <span class=n>telegram_message_text</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>choices</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>message</span><span class=o>.</span><span class=n>content</span><span class=si>}</span><span class=se>\n\n</span><span class=s2>[Read the Article](https://gioleppe.github.io/posts/</span><span class=si>{</span><span class=n>article_name</span><span class=si>}</span><span class=s2>/)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># post message on telegram channel in markdown format</span>
</span></span><span class=line><span class=cl>    <span class=n>telegram_response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;https://api.telegram.org/bot</span><span class=si>{</span><span class=n>telegram_bot_token</span><span class=si>}</span><span class=s2>/sendMessage&#34;</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;chat_id&#34;</span><span class=p>:</span> <span class=n>telegram_channel_id</span><span class=p>,</span> <span class=s2>&#34;text&#34;</span><span class=p>:</span> <span class=n>telegram_message_text</span><span class=p>,</span> <span class=s2>&#34;parse_mode&#34;</span><span class=p>:</span> <span class=s2>&#34;Markdown&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># req_body = req.get_json()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>func</span><span class=o>.</span><span class=n>HttpResponse</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Telegram responded with: </span><span class=si>{</span><span class=n>telegram_response</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>status_code</span><span class=o>=</span><span class=n>telegram_response</span><span class=o>.</span><span class=n>status_code</span><span class=p>)</span>
</span></span></code></pre></div><p>To make this work, you will have to set the following environmental variables:</p><ul><li><strong>AZURE_OPENAI_ENDPOINT</strong>: the endpoint of our Azure OpenAI Service</li><li><strong>AZURE_OPENAI_KEY</strong>: the key of our Azure OpenAI Service</li><li><strong>TELEGRAM_BOT_TOKEN</strong>: the token for the telegram bot that posts to our channel</li><li><strong>TELEGRAM_CHANNEL_ID</strong>: the ID of the channel we want to post to</li></ul><blockquote><p>üí°To post on the Telegram channel, we need a bot that has enough permission to post on that specific channel. After creating the channel, check the walkthrough <a href=https://core.telegram.org/bots/tutorial#obtain-your-bot-token>here</a> to obtain a token. Finally, add your bot to the channel. To get the ID of your channel for usage in the code above, follow the steps outlined <a href=https://gist.github.com/mraaroncruz/e76d19f7d61d59419002db54030ebe35>here</a>.</p></blockquote><p>Assuming you&rsquo;ve set all the parameters above, we can test our Azure Function by running <code>func start</code>:</p><p><img loading=lazy src=images/summarizer_fap_start alt="Summarizer Function App start"></p><p>As you can see, the Azure Function is waiting for our input. You can either use curl like me or a graphical tool such as <a href=https://insomnia.rest/>Insomnia</a> to make the request:</p><pre tabindex=0><code>PS C:\Users\tommaso.colella\projects\articles\summarizer_bot_function&gt; curl -X POST http://localhost:7071/api/SummarizerFunction -H &#39;Content-Type: application/json&#39; -d &#39;{&#34;articleName&#34; : &#34;diy-copilot-phi&#34;}&#39;
Telegram responded with: &lt;Response [200]&gt;
</code></pre><p>If we check our Telegram channel, we can see a freshly made post:</p><p><img loading=lazy src=images/summarizer_first_test alt="Summarizer first test"></p><p>It worked perfectly! The summary is how I wanted it to be. Now, we have to deploy our Function App to Azure. Then, we can test our deployment by committing this new post on Git Hub!</p><h3 id=deploying-and-testing-the-function-app>Deploying and testing the Function App<a hidden class=anchor aria-hidden=true href=#deploying-and-testing-the-function-app>#</a></h3><p>First, provision a new serverless Function App on your Azure subscription. You can follow the instructions <a href=https://learn.microsoft.com/en-us/azure/azure-functions/scripts/functions-cli-create-serverless>here</a> to do it with the Azure CLI or use the Azure Portal.</p><p>Note the name of your Function App. In my case, it is called <em>summarizer-bot-fap</em>. Now, we can use the Azure Functions Core Tools to deploy our Function App as follows:</p><pre tabindex=0><code>func azure functionapp publish
</code></pre><blockquote><p>üí°Remember to set the App Settings for the Function App on the portal or via the command line. If you need extra security, consider using <a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-key-vault-references?tabs=azure-cli">Key Vault references</a>.</p></blockquote><p>If the publish step worked correctly, you should see the Function in the Functions tab of your Function App:</p><p><img loading=lazy src=images/summarizer_fap_portal alt="Summarizer Function App on Azure Portal"></p><p>Now press on the name of your Azure Function, and click the <em>Get Function Url</em> button. The URL you just copied contains the default Host key needed to authenticate to your Function App. It is a proper secret, so treat it carefully! We will use it to call our Function from GitHub Actions.</p><p><img loading=lazy src=images/summarizer_fap_url alt="Summarizer get Function App URL"></p><p>Now head over to GitHub and Add the FUNCTION_URL in the repo settings. If you need help, follow the guide <a href=https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions>here</a>. In the end, you should see this in your repo&rsquo;s <em>Secrets and Variables/Action Secrets</em> section:</p><p><img loading=lazy src=images/summarizer_repo_secrets alt="Summarizer repository secrets"></p><p>And that&rsquo;s it! Time to test the deployment by committing to the repo. We use <em>&ldquo;article: diy-copilot-phi test function app&rdquo;</em> as a commit message.</p><p>After a while, we can see that the trigger summarizer Job is green! If we check the channel, we can see our summary with the relative article link, but I&rsquo;m sparing you the picture this time!</p><p><img loading=lazy src=images/summarizer_action_trigger alt="Summarizer Action triggered"></p><h3 id=conclusions><strong>Conclusions</strong><a hidden class=anchor aria-hidden=true href=#conclusions>#</a></h3><p>We have seen how to create a simple summarization solution using Azure OpenAI, Azure Functions, and GitHub Actions. Our solution could be extended as someone might want to check the produced summary before publishing it: this could be achieved by further refining our Telegram integration and introducing a secondary private channel to approve, modify, or reject summaries. I might do that in a future article, but for my actual need, this implementation is enough.</p><p>Thank you for coming this far. Power to the nerds!</p><h3 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h3><p><a href=https://www.conventionalcommits.org/en/v1.0.0/>Conventional Commits</a></p><p><a href=https://www.geeksforgeeks.org/awk-command-unixlinux-examples/>AWK command in Unix/Linux with examples - GeeksforGeeks</a></p><p><a href=https://gioleppe.github.io/posts/azure-openai-service-opentofu/>Deploying AzureOpenAI Service using OpenTofu | Tommaso Colella | SWE (gioleppe.github.io)</a></p><p><a href="https://learn.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-python?pivots=python-mode-decorators&amp;tabs=windows%2Cbash%2Cazure-cli">Create a Python function from the command line - Azure Functions | Microsoft Learn</a></p><p><a href=https://pypi.org/project/requests/>requests ¬∑ PyPI</a></p><p><a href=https://pypi.org/project/openai/>openai ¬∑ PyPI</a></p><p><a href=https://docs.python.org/3.11/library/venv.html>venv ‚Äî Creation of virtual environments ‚Äî Python 3.11.8 documentation</a></p><p><a href=https://core.telegram.org/bots/tutorial#obtain-your-bot-token>From BotFather to &lsquo;Hello World&rsquo; (telegram.org)</a></p><p><a href=https://learn.microsoft.com/en-us/azure/azure-functions/scripts/functions-cli-create-serverless>Create a serverless function app using the Azure CLI | Microsoft Learn</a></p><p><a href="https://learn.microsoft.com/en-us/azure/app-service/app-service-key-vault-references?tabs=azure-cli">Use Key Vault references - Azure App Service | Microsoft Learn</a></p><p><a href=https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions>Using secrets in GitHub Actions - GitHub Docs</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://gioleppe.github.io/posts/opa-terraform-azure-one/><span class=title>¬´ Prev</span><br><span>Enforcing OPA policies with Terraform / OpenTofu in network-isolated Azure VNet - Part 1</span>
</a><a class=next href=https://gioleppe.github.io/posts/gemma-copilot/><span class=title>Next ¬ª</span><br><span>Self-hosted Copilot using Google Gemma and Ollama (+ Phi-2 comparison)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://gioleppe.github.io/>Tommaso Colella | SWE</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>